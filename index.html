<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Class Portal</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root{
        --bg: #0f172a;
        --card: #0f172a;
        --panel: #0b1220;
        --muted: #9ca3af;
        --accent: #2b6ee6;
        --accent-2: #1f4ed8;
        --green: #16a34a;
        --white: #ffffff;
      }

      /* Full layout*/
      html, body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        font-family: Inter, system-ui, Arial, sans-serif;
        color: var(--white);
      }

      /* Outer wrapper sized to viewport */
      .page {
        height: 100vh;              
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 18px;
        box-sizing: border-box;
      }

      /* Card that contains everything*/
      .card {
        width: 100%;
        max-width: 1200px;
        height: calc(100vh - 36px);
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-radius: 12px;
        border: 1px solid rgba(71,85,105,0.25);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        overflow: hidden;          
      }

      /* Header row */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex: 0 0 auto;
      }
      .header h1 {
        margin: 0;
        font-size: 1.25rem;
      }
      .header .subtitle {
        margin: 0;
        color: var(--muted);
        font-size: 0.95rem;
      }

      /*Tutor grid*/
      .tutor-grid{
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 4 smaller buttons across */
        gap: 10px;
        flex: 0 0 auto;
      }

      /* Tutor card*/
      .tutor-card {
        background: var(--white);
        color: var(--panel);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        font-weight: 800;
        font-size: 0.95rem;
        border: 2px solid transparent;
        transition: transform .09s ease, box-shadow .12s ease, background .12s;
        height: 64px;              
        box-sizing: border-box;
      }

      .tutor-card .name{
        line-height: 1;
      }
      .tutor-card .sub {
        font-size: 0.78rem;
        color: #0f172a;
        opacity: 0.7;
        font-weight: 700;
      }

      .tutor-card:hover{
        transform: translateY(-4px);
        box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      }
      .tutor-card.active{
        background: linear-gradient(180deg, var(--accent), var(--accent-2));
        color: #fff;
        box-shadow: 0 12px 36px rgba(16,24,40,0.55);
        border-color: rgba(255,255,255,0.06);
      }

      /* Video area*/
      .video-area{
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .video-player{
        width: 100%;
        height: 100%;
        border-radius: 10px;
        overflow: hidden;
        background: #000;
        border: 1px solid rgba(255,255,255,0.04);
      }

      .video-player iframe{
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
        background: #000;
      }

      /*Zoom button*/
      .controls { 
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #zoomJoinBtn {
        width: 100%;
        max-width: 520px;
        padding: 14px 18px;
        font-size: 1.05rem;
        font-weight: 800;
        background: var(--green);
        color: #01220d;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(2,60,20,0.22);
        transition: transform .08s ease;
      }
      #zoomJoinBtn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }
      #zoomJoinBtn:not(:disabled):hover { transform: translateY(-3px); }

      @media (max-width: 1100px) {
        .tutor-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .tutor-card { height: 60px; font-size: 0.92rem; }
      }
      @media (max-width: 700px) {
        .card { padding: 12px; }
        .tutor-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .tutor-card { height: 56px; font-size: 0.9rem; }
      }
    </style>
  </head>

  <body>
    <div class="page">
      <div class="card" role="application" aria-label="Class portal">
        <div class="header">
          <div>
            <h1>Class Portal</h1>
          </div>
        </div>

        <!-- tutor buttons -->
        <div class="tutor-grid" id="tutorGrid" aria-hidden="false">
        </div>

        <!-- video player -->
        <div class="video-area">
          <div class="video-player">
            <iframe
              id="mainVideo"
              src=""
              allow="autoplay; fullscreen"
              allowfullscreen
              webkitallowfullscreen
              mozallowfullscreen
              title="Class video player"></iframe>
          </div>
        </div>

        <!-- Zoom control -->
        <div class="controls">
          <button id="zoomJoinBtn" disabled aria-disabled="true">Join Zoom Session</button>
        </div>
      </div>
    </div>

    <script>
      // Set tutors array (name, folderId, zoomLink)
      const COMMON_APPS_SCRIPT_BASE = "https://script.google.com/macros/s/AKfycbzCyDV6ovyNfYUdsayVjiYTYRacMR58GVquNi-qWEzrDrmqEDP_rKIOSDCxy7ZWVq4Xpw/exec";

      const tutors = [
        { name: "DANIEL'S GROUP", folderId: "1xNtOUIMWs1o-b5Oo3_s5TqxN3ZCuuHrt", zoomLink: "https://us05web.zoom.us/j/5411669479?pwd=c1RXdktyaXlGTk1WdUtJMmE3WWtWQT09" },
        { name: "DOM'S GROUP",    folderId: "1f85RbVFBY5LXBj0bpmWBXn5IYTLwYQuA", zoomLink: "https://us04web.zoom.us/j/74792301832?pwd=mFUZcI0XsykRmxADbzPjXkdTsNjatA.1" },
        { name: "HANA'S GROUP",   folderId: "1VYKdKMGwO3NC1UlxB10uG8lEL36aPdC-",    zoomLink: "https://us04web.zoom.us/j/79594039777?pwd=Svn9g6SaDN47h5Rd500HWGgP9yZZM8.1" },
        { name: "SERENA'S GROUP", folderId: "1hcvu6q7B8kp1xG3zPZSWJKc4nhnE8sVn",  zoomLink: "https://us05web.zoom.us/j/85247366939?pwd=KKQoK7BcCkGhQulcUoPp8cxBhdlLS8.1&jst=2" }
      ];

      // DOM refs
      const tutorGrid = document.getElementById("tutorGrid");
      const mainVideo = document.getElementById("mainVideo");
      const zoomJoinBtn = document.getElementById("zoomJoinBtn");

      let activeIndex = null;

      // Render tutor buttons
      function renderTutorButtons(){
        tutorGrid.innerHTML = "";
        tutors.forEach((tutor, i) => {
          const btn = document.createElement("button");
          btn.className = "tutor-card";
          btn.type = "button";
          btn.setAttribute("aria-pressed", "false");
          btn.innerHTML = `<div class="name">${escapeHtml(tutor.name)}</div>`;
          btn.addEventListener("click", () => selectTutor(i, btn));
          tutorGrid.appendChild(btn);
        });
      }

      // Highlight and select a tutor
      function selectTutor(index, btnEl){
        // remove active from others
        Array.from(tutorGrid.children).forEach((c, idx) => {
          if (idx === index) {
            c.classList.add("active");
            c.setAttribute("aria-pressed", "true");
          } else {
            c.classList.remove("active");
            c.setAttribute("aria-pressed", "false");
          }
        });

        activeIndex = index;
        const tutor = tutors[index];

        // config Zoom button
        if (tutor.zoomLink && tutor.zoomLink.trim()) {
          zoomJoinBtn.disabled = false;
          zoomJoinBtn.removeAttribute("aria-disabled");
          zoomJoinBtn.onclick = () => window.open(tutor.zoomLink, "_blank");
        } else {
          zoomJoinBtn.disabled = true;
          zoomJoinBtn.setAttribute("aria-disabled", "true");
          zoomJoinBtn.onclick = null;
        }

        // load the latest video for this tutor
        loadFirstVideoForFolder(tutor.folderId).catch(err => {
          console.error(err);
          // clear player on error
          mainVideo.src = "";
        });
      }

      // Apps script URL with folderid + cache
      function makeAppsScriptUrl(folderId) {
        if (!COMMON_APPS_SCRIPT_BASE) return null;
        const sep = COMMON_APPS_SCRIPT_BASE.includes("?") ? "&" : "?";
        const cb = "_cb=" + Date.now();
        return `${COMMON_APPS_SCRIPT_BASE}${sep}folderId=${encodeURIComponent(folderId)}&${cb}`;
      }

      // Fetch the list and play the first video
      async function loadFirstVideoForFolder(folderId) {
        if (!folderId || !folderId.trim()) {
          throw new Error("No folderId configured for this tutor.");
        }

        const url = makeAppsScriptUrl(folderId);
        if (!url) throw new Error("Apps Script base URL not configured.");

        // fetch JSON
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("Network error: " + res.status);
        const data = await res.json();

        if (data && data.error) throw new Error(data.error);
        if (!Array.isArray(data) || data.length === 0) {
          throw new Error("No videos found in that folder.");
        }

        const first = data[0];
        if (!first || !first.previewUrl) throw new Error("No preview URL found.");

        // Google drive preview
        mainVideo.src = first.previewUrl;
      }

      // Simple escape to avoid injection in innerHTML
      function escapeHtml(s) {
        return String(s || "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      // initial render
      renderTutorButtons();
    </script>
  </body>
</html>


