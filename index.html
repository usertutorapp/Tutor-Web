<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Class Portal</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root{
        --bg: #0f172a;
        --card: #0f172a;
        --panel: #0b1220;
        --muted: #9ca3af;
        --accent: #2b6ee6; /* brighter blue */
        --accent-2: #1f4ed8;
        --green: #16a34a;
        --white: #ffffff;
      }

      /* Full-viewport layout - single page (no scroll) */
      html, body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        font-family: Inter, system-ui, Arial, sans-serif;
        color: var(--white);
      }

      /* Outer wrapper sized to viewport and prevents scrolling */
      .page {
        height: 100vh;               /* full viewport */
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 18px;
        box-sizing: border-box;
      }

      /* Card that contains everything; fixed max height so no scroll */
      .card {
        width: 100%;
        max-width: 1200px;
        height: calc(100vh - 36px);  /* fill inside padding */
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-radius: 12px;
        border: 1px solid rgba(71,85,105,0.25);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        overflow: hidden;           /* ensure nothing scrolls */
      }

      /* Header row */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex: 0 0 auto;
      }
      .header h1 {
        margin: 0;
        font-size: 1.25rem;
      }
      .header .subtitle {
        margin: 0;
        color: var(--muted);
        font-size: 0.95rem;
      }

      /* Tutor grid (smaller so fits) */
      .tutor-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 4 smaller buttons across */
        gap: 10px;
        flex: 0 0 auto;
      }

      /* Tutor card/button */
      .tutor-card {
        background: var(--white);
        color: var(--panel);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        font-weight: 800;
        font-size: 0.95rem;
        border: 2px solid transparent;
        transition: transform .09s ease, box-shadow .12s ease, background .12s;
        height: 64px;                 /* compact */
        box-sizing: border-box;
      }

      .tutor-card .name {
        line-height: 1;
      }
      .tutor-card .sub {
        font-size: 0.78rem;
        color: #0f172a;
        opacity: 0.7;
        font-weight: 700;
      }

      .tutor-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      }
      .tutor-card.active {
        background: linear-gradient(180deg, var(--accent), var(--accent-2));
        color: #fff;
        box-shadow: 0 12px 36px rgba(16,24,40,0.55);
        border-color: rgba(255,255,255,0.06);
      }

      /* Video area - fills most of card */
      .video-area {
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .video-player {
        width: 100%;
        height: 100%;
        border-radius: 10px;
        overflow: hidden;
        background: #000;
        border: 1px solid rgba(255,255,255,0.04);
      }

      .video-player iframe {
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
        background: #000;
      }

      /*Zoom button*/
      .controls { 
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #zoomJoinBtn {
        width: 100%;
        max-width: 520px;
        padding: 14px 18px;
        font-size: 1.05rem;
        font-weight: 800;
        background: var(--green);
        color: #01220d;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(2,60,20,0.22);
        transition: transform .08s ease;
      }
      #zoomJoinBtn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }
      #zoomJoinBtn:not(:disabled):hover { transform: translateY(-3px); }

      @media (max-width: 1100px) {
        .tutor-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .tutor-card { height: 60px; font-size: 0.92rem; }
      }
      @media (max-width: 700px) {
        .card { padding: 12px; }
        .tutor-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .tutor-card { height: 56px; font-size: 0.9rem; }
      }
    </style>
  </head>

  <body>
    <div class="page">
      <div class="card" role="application" aria-label="Class portal">
        <div class="header">
          <div>
            <h1>Class Portal</h1>
          </div>
        </div>

        <!-- Tutor buttons -->
        <div class="tutor-grid" id="tutorGrid" aria-hidden="false">
        </div>

        <!-- Big video player -->
        <div class="video-area">
          <div class="video-player">
            <iframe
              id="mainVideo"
              src=""
              allow="autoplay; fullscreen"
              allowfullscreen
              webkitallowfullscreen
              mozallowfullscreen
              title="Class video player"></iframe>
          </div>
        </div>

        <!-- Zoom control -->
        <div class="controls">
          <button id="zoomJoinBtn" disabled aria-disabled="true">Join Zoom Session</button>
        </div>
      </div>
    </div>

    <script>
      /*
         - Set tutors array (name, folderId, zoomLink)
      */
      const COMMON_APPS_SCRIPT_BASE = "https://script.google.com/macros/s/AKfycbzCyDV6ovyNfYUdsayVjiYTYRacMR58GVquNi-qWEzrDrmqEDP_rKIOSDCxy7ZWVq4Xpw/exec";

      const tutors = [
        { name: "DANIEL'S GROUP", folderId: "1S8DczuWyzoG8Wcg-ch0L3b1a4cOgs8ei", zoomLink: "https://zoom.us/j/111111111?pwd=AAA" },
        { name: "DOM'S GROUP",    folderId: "1BuCkV_sNvUZ8OyI6irLsHdn0UvXOzq3Z", zoomLink: "https://zoom.us/j/222222222?pwd=BBB" },
        { name: "HANA'S GROUP",   folderId: "1S8DczuWyzoG8Wcg-ch0L3b1a4cOgs8ei",    zoomLink: "https://zoom.us/j/333333333?pwd=CCC" },
        { name: "SERENA'S GROUP", folderId: "1S8DczuWyzoG8Wcg-ch0L3b1a4cOgs8ei",  zoomLink: "https://zoom.us/j/444444444?pwd=DDD" }
      ];

      // DOM refs
      const tutorGrid = document.getElementById("tutorGrid");
      const mainVideo = document.getElementById("mainVideo");
      const zoomJoinBtn = document.getElementById("zoomJoinBtn");

      let activeIndex = null;

      // Render tutor buttons (compact)
      function renderTutorButtons() {
        tutorGrid.innerHTML = "";
        tutors.forEach((tutor, i) => {
          const btn = document.createElement("button");
          btn.className = "tutor-card";
          btn.type = "button";
          btn.setAttribute("aria-pressed", "false");
          btn.innerHTML = `<div class="name">${escapeHtml(tutor.name)}</div>`;
          btn.addEventListener("click", () => selectTutor(i, btn));
          tutorGrid.appendChild(btn);
        });
      }

      // Highlight and select a tutor
      function selectTutor(index, btnEl) {
        // remove active from others
        Array.from(tutorGrid.children).forEach((c, idx) => {
          if (idx === index) {
            c.classList.add("active");
            c.setAttribute("aria-pressed", "true");
          } else {
            c.classList.remove("active");
            c.setAttribute("aria-pressed", "false");
          }
        });

        activeIndex = index;
        const tutor = tutors[index];

        // configure Zoom button
        if (tutor.zoomLink && tutor.zoomLink.trim()) {
          zoomJoinBtn.disabled = false;
          zoomJoinBtn.removeAttribute("aria-disabled");
          zoomJoinBtn.onclick = () => window.open(tutor.zoomLink, "_blank");
        } else {
          zoomJoinBtn.disabled = true;
          zoomJoinBtn.setAttribute("aria-disabled", "true");
          zoomJoinBtn.onclick = null;
        }

        // load the latest video for this tutor
        loadFirstVideoForFolder(tutor.folderId).catch(err => {
          console.error(err);
          // clear player on error
          mainVideo.src = "";
        });
      }

      // Build Apps Script URL with folderId + cache-buster
      function makeAppsScriptUrl(folderId) {
        if (!COMMON_APPS_SCRIPT_BASE) return null;
        const sep = COMMON_APPS_SCRIPT_BASE.includes("?") ? "&" : "?";
        const cb = "_cb=" + Date.now();
        return `${COMMON_APPS_SCRIPT_BASE}${sep}folderId=${encodeURIComponent(folderId)}&${cb}`;
      }

      // Fetch the list and play the first video (newest)
      async function loadFirstVideoForFolder(folderId) {
        if (!folderId || !folderId.trim()) {
          throw new Error("No folderId configured for this tutor.");
        }

        const url = makeAppsScriptUrl(folderId);
        if (!url) throw new Error("Apps Script base URL not configured.");

        // fetch JSON
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("Network error: " + res.status);
        const data = await res.json();

        if (data && data.error) throw new Error(data.error);
        if (!Array.isArray(data) || data.length === 0) {
          throw new Error("No videos found in that folder.");
        }

        const first = data[0];
        if (!first || !first.previewUrl) throw new Error("No preview URL found.");

        // set iframe src to Google Drive preview
        mainVideo.src = first.previewUrl;
      }

      // Simple escape to avoid injection in innerHTML
      function escapeHtml(s) {
        return String(s || "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      // initial render + optionally auto-select first valid tutor
      renderTutorButtons();
    </script>
  </body>
</html>
